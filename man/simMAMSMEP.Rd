% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MAMSMEP_SIMULATION_MAIN.R
\name{simMAMSMEP}
\alias{simMAMSMEP}
\title{Function to perform Adaptive GMCP simulation for Multi-Arm Multi-Stage Multi-Endpoint simulations for Combining p-values method and CER method(2-Stage)}
\usage{
simMAMSMEP(
  Method = "CombPValue",
  alpha = 0.025,
  SampleSize = 500,
  TestStat = "t-equal",
  FWERControl = "CombinationTest",
  nArms = 3,
  nEps = 2,
  Arms.Mean = list(EP1 = c(0, 0.4, 0.3), EP2 = c(0.1, 0.45, 0.25)),
  Arms.std.dev = list(EP1 = c(1, 1, 1), EP2 = c(1, 1, 1)),
  Arms.alloc.ratio = c(1, 1, 1),
  EP.Corr = matrix(c(1, 0.5, 0.5, 1), nrow = 2),
  WI = c(0.5, 0.5, 0, 0),
  G = matrix(c(0, 0.5, 0.5, 0, 0.5, 0, 0, 0.5, 0, 1, 0, 0, 1, 0, 0, 0), nrow = nEps *
    (nArms - 1), byrow = T),
  test.type = "Partly-Parametric",
  info_frac = c(0.5, 1),
  typeOfDesign = "asOF",
  MultipleWinners = TRUE,
  Selection = TRUE,
  SelectionLook = 1,
  SelectEndPoint = 1,
  SelectionScale = "pvalue",
  SelectionCriterion = "best",
  SelectionParmeter = 1,
  KeepAssosiatedEps = TRUE,
  ImplicitSSR = "All",
  nSimulation = 1000,
  Seed = 100,
  SummaryStat = FALSE,
  plotGraphs = TRUE,
  Parallel = TRUE
)
}
\arguments{
\item{Method}{'CombPValue': for combining p-values method, 'CER': for Conditional Error method.}

\item{alpha}{Type-1 error}

\item{SampleSize}{integer valued Sample Size(default: 500)}

\item{TestStat}{'t-equal' : for t statistics with equal variance, 't-unequal' : for t statistics with unequal variance, 'z' for z statistics}

\item{FWERControl}{applicable for CER method only, 'CombinationTest': combined two stage incremental test statistics, 'None': Cumulative test statistics.}

\item{nArms}{integer value to specify the number of arms (default: 3)}

\item{nEps}{integer value to specify the number of endpoints}

\item{Arms.Mean}{Numeric list to specify the arm-wise mean for each endpoint; Note: The first input is for control arm and the rest are for the treatments.}

\item{Arms.std.dev}{Numeric list to specify the arm-wise standard deviation for each endpoint; Note: The first input is for control arm and the rest are for the treatments.}

\item{Arms.alloc.ratio}{Numeric Vector to specify the arm-wise allocation ratio; Note: The first input is for control arm and the rest are for the treatments.}

\item{EP.Corr}{correlation matrix for the endpoints(Normal)}

\item{WI}{Vector of Initial Weights for Global Null; Note: Hypotheses will follow the order of Endpoints and Treatments as given in 'Arms.Mean' and 'Arms.std.dev' inputs e.g.: If 'Arms.Mean' are given in the format list('EP1'=c(ctr_mean, trt1_mean, trt2_mean), 'EP2'=c(ctr_mean, trt1_mean, trt2_mean)) then the four hypotheses will be H1 = (Trt1 vs Ctr for EP1), H2 = (Trt2 vs Ctr for EP1), H3 = (Trt1 vs Ctr for EP2), H4 = (Trt2 vs Ctr for EP2), The initial weights and the transition matrix will follow the order of hypothesis accordingly as (H1,H2,H3,H4)}

\item{G}{Numeric Matrix to specify the Transition Matrix.}

\item{test.type}{Character to specify the type of test want to perform; Available tests for Combining P-values Method :- 'Bonf': Bonferroni, 'Sidak': Sidak, 'Simes': Simes, 'Dunnett': Dunnett and  'Partly-Parametric': Mixed type Tests. Available tests for CER Method :- "Parametric": Weighted Dunnett , "Non-Parametric": Weighted Bonferroni and  'Partly-Parametric': Mixed type Tests.}

\item{info_frac}{Numeric Vector to specify look position as fraction of sample size.(for one look can be specified as 1)}

\item{typeOfDesign}{The type of design. Type of design is one of the following: O'Brien & Fleming ("OF"), Pocock ("P"), Wang & Tsiatis Delta class ("WT"), Pampallona & Tsiatis ("PT"), Haybittle & Peto ("HP"), Optimum design within Wang & Tsiatis class ("WToptimum"), O'Brien & Fleming type alpha spending ("asOF"), Pocock type alpha spending ("asP"), Kim & DeMets alpha spending ("asKD"), Hwang, Shi & DeCani alpha spending ("asHSD"), no early efficacy stop ("noEarlyEfficacy"), default is "OF".}

\item{MultipleWinners}{Logical; TRUE: Stop the trial only no more efficacy is possible, FALSE: Stop if at-least one efficacy is observed}

\item{Selection}{Logical: TRUE if selection required at interim(default = FALSE)}

\item{SelectionLook}{Numeric Vector to specify the selection looks}

\item{SelectEndPoint}{Indicator to specify which endpoint to select from, e.g. '1': Endpoint 1, '2':Endpoint 2, 'overall': overall}

\item{SelectionScale}{Character: Scale parameter on which selection will be based on, options 'delta': delta, 'teststat': Test Statistics, 'stderror' : Standard Error of the test stat,  'pvalue': p-value(un-adj) based selection}

\item{SelectionCriterion}{Character: 'best': best r, 'threshold': threshold for selection, 'epsilon': for epsilon neighborhood}

\item{SelectionParmeter}{r for best, threshold value for threshold or epsilon distance}

\item{KeepAssosiatedEps}{Logical, True: keep all the associated hypothesis for the selected arms}

\item{ImplicitSSR}{Character; 'Selection': re-allocate samples only from de-selected arms to available arms, 'All': Allocate all the planned samples(for the look) to the available arms, 'None': No Re-allocation}

\item{nSimulation}{Numeric: number of simulations(default=1000)}

\item{Seed}{'Random' for randomly generating seed else any integer value(default = 'Random')}

\item{SummaryStat}{Logical; TRUE if simulation level data is required(default = FALSE)}

\item{plotGraphs}{Logical; TRUE: plot the initial graph}

\item{Parallel}{Logical; TRUE: Parallel computations}

\item{UpdateStrategy}{Logical to specify the updated strategy (Not Implemented yet) default FALSE}
}
\description{
Function to perform Adaptive GMCP simulation for Multi-Arm Multi-Stage Multi-Endpoint simulations for Combining p-values method and CER method(2-Stage)
}
\examples{

suppressWarnings(library(AdaptGMCP))
library(rstudioapi)


timeNow <- format(Sys.time(), "\%Y-\%m-\%d_\%H-\%M-\%S")
ConsoleOutput <- file(paste0("Console_output_", timeNow, ".txt")) # File name of output log
sink(ConsoleOutput, append = TRUE, type = 'output')
sink(ConsoleOutput, append = TRUE, type = 'message')
cat(readChar(rstudioapi::getSourceEditorContext()$path, # Writing currently opened R script to file
             file.info(rstudioapi::getSourceEditorContext()$path)$size))


########################## Inputs ##############################
#------------------Test Method----------------------------------
#options- 'CombPValue': Combining p-values, 'CER': Conditional Error
Method <- 'CER' #CombPValue/CER

#-----------------------Total Sample Size------------------------
SampleSize <- 324
#-----------------------Design Alpha-----------------------------
alpha <- 0.025

#----------------------Test Statistics---------------------------
#options : 'z' :- Z Statistics, 't-equal' :- t Statistics with equal variance, 't-unequal' :- t Statistics with unequal variance
TestStat <- 't-equal'

#---------FWER Control Method(Applicable for CER Method only)------
#options: 'CombinationTest' : combined incremental p-values for stage-2 testing, 'None': Cumulative classical test statistics.
FWERControl <- 'None'

#-----------------------Number of Arms--------------------------
nArms <- 3

#-------------------Number of Endpoints-------------------------
nEps  <- 2
#-------------Arm-Wise mean for each endpoints-----------------
#Note: The first input is for control arm and the rest are for the treatments
Arms.Mean <- list('EP1' = c(0,0.4,0.3),
                 'EP2' = c(0.1,0.45,0.25))

#-------------Arm-Wise planned Std. Dev. for each endpoints-----
#Note: The first input is for control arm and the rest are for the treatments
Arms.std.dev <- list('EP1' = c(1.1,1.2,1.3),
                     'EP2' = c(1.5,1.6,1.7))

#-------------Arm-Wise planned allocation Ratio----------------
#Note: The first input is for control arm and the rest are for the treatments
Arms.alloc.ratio <- c(1,1,1)

#-------------Correlation between End points -------------------
EP.Corr <- matrix(c(1,0.5,
                   0.5,1),
                 nrow = 2)

#----------------Initial Weights---------------------
#Note: Hypotheses will follow the order of Endpoints and Treatments as given in 'Arms.Mean' and 'Arms.std.dev' inputs
#e.g.: If 'Arms.Mean' are given in the format list('EP1'=c(ctr_mean, trt1_mean, trt2_mean), 'EP2'=c(ctr_mean, trt1_mean, trt2_mean)) then the hypothesis will be
# H1 = (Trt1 vs Ctr for EP1), H2 = (Trt2 vs Ctr for EP1), H3 = (Trt1 vs Ctr for EP2), H4 = (Trt2 vs Ctr for EP2)
#The initial weights and the transition matrix will follow the order accordingly as (H1,H2,H3,H4)

WI <-  c(0.5,0.5,0,0)

#---------------Transition Matrix--------------------
G <- matrix(c(0,0.5,0.5,0,
             0.5,0,0,0.5,
             0,1,0,0,
             1,0,0,0),
           nrow = nEps*(nArms-1), byrow = T)

#-------------------Test Type------------------------
# Testing Procedure
#Available tests for Combining P-values Method :- 'Bonf','Sidak','Simes','Dunnett','Partly-Parametric'
#Available tests for CER Method :- 'Parametric','Non-Parametric','Partly-Parametric'
test.type <- 'Partly-Parametric'

#----------------Information Fraction----------------
#The number of lookes is same as the length of info_frac(for FSD info_frac = 1)
info_frac <-  c(1/2,1)

#-------------------Boundary Type-------------------
# O'Brien & Fleming = 'OF', Pocock = 'P', Wang & Tsiatis Delta class = 'WT'
# Pampallona & Tsiatis = 'PT', Haybittle & Peto = 'HP',
# Optimum design within Wang & Tsiatis class = 'WToptimum'
# O'Brien & Fleming type alpha spending = 'asOF', Pocock type alpha spending = 'asP'
# Kim & DeMets alpha spending = 'asKD', Hwang, Shi & DeCani alpha spending = 'asHSD'
# no early efficacy stop = 'noEarlyEfficacy'
# default is "asOF"

typeOfDesign <- "asOF"

#-----------------Multiple Winner Option--------------
MultipleWinners <- TRUE

#-----------------Treatment Selection Choice--------------
Selection <- TRUE

#-----------------Selection based on look-------------
SelectionLook <- 1

#-----------------Selection Endpoint----------------------
#options- '1': Endpoint 1, '2':Endpoint 2, 'overall': overall
SelectEndPoint <- 1

#-----------------Selection Based on----------------------
#Options- 'delta': delta, 'teststat': Test Statistics, 'stderror' : Standard Error of the test stat,  'pvalue': p-value(un-adj)
SelectionScale <- 'pvalue'

#-----------------Selection Criteria----------------------
#Options- 'best': best r, 'threshold': threshold for selection, 'epsilon': for epsilon neighborhood
SelectionCriterion <- 'best'

#-----------------Selection Criteria Parameter----------------------
# r for best, threshold value for threshold and epsilon distance for criteria 'epsilon'
SelectionParmeter <- 1

#----------------Keep associated Hypothesis-------------------------
#TRUE: keep all the associated hypothesis for the selected arms, FALSE otherwise
KeepAssosiatedEps <- TRUE

#-------------------Implicit SSR-------------------------------------
#'Selection': re-allocate samples only from de-selected arms to available arms,
#'All': Allocate all the planned samples(for the look) to the available arms,
#'None': No Re-allocation
ImplicitSSR <- 'Selection'

#-------------------Number of Simulations-------------------------------------
nSimulation <- 10

#-------------------Simulation Seed-------------------------------------
Seed <- 100

#------------------Print Summary Statistics file------------------------
SummaryStat <- FALSE

#-------------------Plot Initial Graph------------------------
plotGraphs <- TRUE

#--------------Parallel Logical; TRUE: Parallel computations--------
Parallel <- TRUE

#-----------------------Run Simulation--------------------------------------
#Please uncomment the following code to run the simulation(short-cut to uncomment 1.Select the lines, 2.ctr+shift+c)
#
out <- simMAMSMEP(alpha = alpha, SampleSize = SampleSize,nArms = nArms,nEps = nEps, TestStat=TestStat, FWERControl = FWERControl,
           Arms.Mean = Arms.Mean, Arms.std.dev = Arms.std.dev, Arms.alloc.ratio = Arms.alloc.ratio,
           EP.Corr = EP.Corr,WI = WI, G = G, test.type = test.type,info_frac = info_frac,
           typeOfDesign = typeOfDesign, MultipleWinners = MultipleWinners,
           Selection = Selection,SelectionLook = SelectionLook,SelectEndPoint = SelectEndPoint,SelectionScale = SelectionScale,
           SelectionCriterion = SelectionCriterion, SelectionParmeter = SelectionParmeter, KeepAssosiatedEps = KeepAssosiatedEps,
           ImplicitSSR = ImplicitSSR, nSimulation = nSimulation, Seed = Seed, SummaryStat = SummaryStat,
           Method = Method, plotGraphs = plotGraphs, Parallel = Parallel)
out

closeAllConnections() # Close connection to log file
save(out, file = paste0("Output_simMAMSMEP_",timeNow, ".RData"))
}
